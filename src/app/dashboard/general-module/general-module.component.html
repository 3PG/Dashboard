<guild-sidebar [waitFor]="savedGuild && general && reactionRoleMessages">
    <div *ngIf="form" class="container">
        <form #f="ngForm" [formGroup]="form">
            <div>
                <div class="d-flex justify-content-between">
                    <h1 routerLink="/docs/general"
                        class="display-3">General</h1>
                </div>
                <hr>
            </div>
            <div class="row">
                <div class="col-lg-4 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Prefix</mat-label>
                        <input matInput
                            formControlName="prefix" type="text">
                    </mat-form-field>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Ignored Channels</mat-label>
                        <mat-select multiple
                            formControlName="ignoredChannels">
                            <mat-option *ngFor="let channel of textChannels" 
                                [value]="channel.id">#{{ channel.name }}
                                <span class="float-right text-muted">[{{ getChannel(channel.parentID)?.name || 'N/A' }}]</span>
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Auto Roles</mat-label>
                        <mat-select multiple
                            formControlName="autoRoles">
                            <mat-option *ngFor="let role of roles" 
                                [value]="role.id"
                                [style.color]="'#' + role.color?.toString(16)">@{{ role.name }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <hr>
            <h3>Reaction Roles</h3>
            <p class="desc">React to messages to get roles</p>
            <div class="row">
                <div formArrayName="reactionRoles" class="row">
                    <div class="col-lg-6 col-md-12" *ngFor="let i of reactionRolesIndices">
                        <div [formGroupName]="i"
                            class="rounded reaction-role">
                            <mat-form-field appearance="outline" class="p-2">
                                <mat-label>Channel</mat-label>
                                <mat-select formControlName="channel">
                                    <mat-option *ngFor="let channel of textChannels" 
                                        [value]="channel.id">#{{ channel.name }}
                                        <span class="float-right text-muted">[{{ getChannel(channel.parentID)?.name || 'N/A' }}]</span>
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <!-- message -->
                            <mat-form-field appearance="outline" class="p-2">                                
                                <mat-label>Message ID</mat-label>
                                <input matInput formControlName="messageId" type="text">
                            </mat-form-field>
                            <!-- emote -->
                            <mat-form-field appearance="outline" class="p-2">
                                <mat-label>Emote</mat-label>
                                <input matInput #emote
                                    formControlName="emote" type="text">
                            </mat-form-field>
                            <!-- role -->
                            <mat-form-field appearance="outline" class="p-2">
                                <mat-label>Role</mat-label>
                                <mat-select
                                    formControlName="role">
                                    <mat-option *ngFor="let role of roles" 
                                        [value]="role.id"
                                        [style.color]="'#' + role.color?.toString(16)">@{{ role.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                            <div *ngIf="reactionRoleMessages[i]">
                                <message-preview
                                    [author]="reactionRoleMessages[i].author"
                                    [createdAt]="toDate(reactionRoleMessages[i].createdTimestamp)"
                                    [content]="reactionRoleMessages[i].reactions.message.cleanContent"
                                    [member]="reactionRoleMessages[i].member"></message-preview>
                            </div>
                            <div *ngIf="!reactionRoleMessages[i]">
                                <message-preview content="Message not found."></message-preview>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- add form-control-name -->
            </div>
        </form>
    </div>
</guild-sidebar>
